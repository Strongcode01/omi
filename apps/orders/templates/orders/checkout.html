{% extends "base.html" %}
{% load static %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'orders/css/checkout.css' %}">
<style>
  :root {
    --primary:    #1f0030;
    --primary-d:  #006fa3;
    --accent:     #ff135d;
    --bg-page:    #e1ebff;
    --bg-card:    #d2d2d2;
    --text:       #18031f;
    --radius:     8px;
    --shadow:     0 4px 12px rgba(0,0,0,0.05);
    --gap:        1.5rem;
  }

  .checkout-container {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: var(--gap);
    padding: 3rem 1rem;
    background: var(--bg-page);
  }

  /* Left card twice as wide/tall as right */
  .billing-details { flex: 2 1 500px; }
  .order-summary   { flex: 1 1 300px; }

  .card {
    background: var(--bg-card);
    border-radius: var(--radius);
    box-shadow: var(--shadow);
    padding: 2rem;
    color: var(--text);
  }

  .checkout-title {
    margin: 0 0 1.5rem;
    color: var(--primary);
    font-size: 1.5rem;
    text-align: center;
  }

  /* Use CSS grid for the form */
  .billing-details form {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    grid-gap: var(--gap);
  }

  /* Full-width fields span both columns */
  .form-full {
    grid-column: 1 / -1;
  }

  .form-group {
    display: flex;
    flex-direction: column;
  }

  .form-group label {
    margin-bottom: 0.4rem;
    font-weight: 600;
  }

  .form-group .form-control {
    padding: 0.75rem 1rem;
    border: 1px solid #ccc;
    border-radius: var(--radius);
    background: #fff;
  }

  /* Place order button spans both columns */
  .btn-place-order {
    grid-column: 1 / -1;
    justify-self: center;
    margin-top: var(--gap);
    padding: 0.85rem 2rem;
    background: var(--primary);
    color: #fff;
    border: none;
    border-radius: var(--radius);
    font-weight: 600;
    cursor: pointer;
    transition: background 0.4s;
  }
  .btn-place-order:hover {
    background: var(--primary-d);
  }

  /* Order summary table styling */
  .order-summary table {
    width: 100%;
    border-collapse: collapse;
  }
  .order-summary th,
  .order-summary td {
    padding: 0.75rem 0;
    border-bottom: 1px solid #eee;
  }
  .order-summary th { text-align: left; font-weight: 600; }
  .total-row td {
    font-weight: 700;
    color: var(--accent);
  }

  @media (max-width: 768px) {
    .checkout-container {
      flex-direction: column;
      padding: 2rem 1rem;
    }
    .billing-details form {
      grid-template-columns: 1fr;
    }
  }
</style>
{% endblock %}

{% block title %}Checkout{% endblock %}

{% block content %}
<div class="checkout-container">

  <!-- Left: Billing & Payment -->
  <div class="card billing-details">
    <h2 class="checkout-title">CHECKOUT</h2>
    <form method="post">
      {% csrf_token %}

      {# Full-width fields #}
      <div class="form-group form-full">
        {{ form.full_name.label_tag }}
        {{ form.full_name }}
        {% for err in form.full_name.errors %}
          <div class="error-message">{{ err }}</div>
        {% endfor %}
      </div>
      <div class="form-group form-full">
        {{ form.email.label_tag }}
        {{ form.email }}
        {% for err in form.email.errors %}
          <div class="error-message">{{ err }}</div>
        {% endfor %}
      </div>
      <div class="form-group form-full">
        {{ form.street_address.label_tag }}
        {{ form.street_address }}
        {% for err in form.street_address.errors %}
          <div class="error-message">{{ err }}</div>
        {% endfor %}
      </div>

      {# Two-column fields #}
      <div class="form-group">
        {{ form.phone.label_tag }}
        {{ form.phone }}
        {% for err in form.phone.errors %}
          <div class="error-message">{{ err }}</div>
        {% endfor %}
      </div>
      <div class="form-group">
        {{ form.city.label_tag }}
        {{ form.city }}
        {% for err in form.city.errors %}
          <div class="error-message">{{ err }}</div>
        {% endfor %}
      </div>
      <div class="form-group">
        {{ form.postcode.label_tag }}
        {{ form.postcode }}
        {% for err in form.postcode.errors %}
          <div class="error-message">{{ err }}</div>
        {% endfor %}
      </div>
      <div class="form-group">
        {{ form.address_line2.label_tag }}
        {{ form.address_line2 }}
        {% for err in form.address_line2.errors %}
          <div class="error-message">{{ err }}</div>
        {% endfor %}
      </div>

      {# Payment method & notes full width #}
      <div class="form-group form-full">
        {{ form.payment_method.label_tag }}
        {{ form.payment_method }}
      </div>
      <div class="form-group form-full">
        {{ form.notes.label_tag }}
        {{ form.notes }}
      </div>

      <button type="submit" class="btn-place-order">Place Order</button>
    </form>
  </div>

  <!-- Right: Order Summary -->
  <div class="card order-summary">
    <h2 class="checkout-title">YOUR ORDER</h2>
    <table>
      <thead>
        <tr><th>Product</th><th>Total</th></tr>
      </thead>
      <tbody>
        {% for item in items %}
          <tr>
            <td>{{ item.product.title }} × {{ item.quantity }}</td>
            <td>₦{{ item.subtotal|floatformat:0 }}</td>
          </tr>
        {% endfor %}
        <tr class="total-row">
          <td><strong>Total</strong></td>
          <td><strong>₦{{ cart_total|floatformat:0 }}</strong></td>
        </tr>
      </tbody>
    </table>
  </div>

</div>
{% endblock %}
