{% extends 'base.html' %}
{% load static %}

{% block extra_css %}
  <link rel="stylesheet" href="{% static 'css/product_detail.css' %}">
{% endblock %}

{% block title %}{{ product.title }}{% endblock %}

{% block content %}
  <div style="display:flex; 
    flex-wrap:wrap; 
    gap:2rem; 
    align-items: center; 
    justify-content: center; 
    min-height: 70vh;
    margin: 1rem 0 1rem 4rem;
    ">
    <!-- Left: product image/info -->
    <div style="flex:1 1 300px; background:rgba(0,0,0,0.8); padding:1rem; border-radius:8px;
                border:1px solid var(--omi-neon-blue); box-shadow:0 0 8px var(--omi-neon-blue);">
      <img src="{{ product.image.url }}" alt="{{ product.title }}" 
           style="width:100%; border-radius:4px; margin-bottom:1rem;">
      <h2 style="color:var(--omi-neon-pink);">{{ product.title }}</h2>
      <p style="color:var(--omi-text-strong);">{{ product.description }}</p>
      <p style="font-weight:bold; color:var(--omi-neon-blue);">â‚¦{{ product.price }}</p>
      <p style="color:var(--omi-text-strong);">
        Size: {{ product.size }} | Pond: {{ product.pond_type }} | Health: {{ product.health_status }}
      </p>

      <form action="{% url 'cart:cart_update' product.pk %}" method="post" style="margin-top:1rem;">
        {% csrf_token %}
        <input
          type="number"
          name="quantity"
          value="1"
          min="1"
          style="width:4rem; text-align:center;"
        />
        <button type="submit"
          style="background: var(--omi-neon-blue); padding:0.4rem 0.8rem; border:none; border-radius:4px;">
          Add / Update
        </button>
      </form>
      
      <a href="{% url 'cart:cart_add' product.pk %}" 
         style="display:inline-block; margin-top:1rem;
                background:var(--omi-neon-blue); padding:0.5rem 1rem; 
                color:#000; border-radius:4px; box-shadow:0 0 6px var(--omi-neon-blue);">
        Add to Cart
      </a>
    </div>

    <!-- Right: reviews + review form -->
    <div style="flex:1 1 300px; padding:1rem;">
      <h3 style="color:var(--omi-neon-pink);">Reviews</h3>
      <ul style="list-style:none; padding:0;">
        {% for review in product.reviews.all %}
          {% if review.approved %}
            <li style="margin-bottom:1rem; padding:0.5rem; background:rgba(255,255,255,0.1);
                       border-left:4px solid var(--omi-neon-blue);">
              <strong style="color:var(--omi-neon-blue);">{{ review.user.username }}</strong>:
              {{ review.rating }}/5
              <p style="margin:0.5rem 0; color:var(--omi-text-strong);">{{ review.comment }}</p>
            </li>
          {% endif %}
        {% empty %}
          <li style="color:var(--omi-text-strong);">No reviews yet.</li>
        {% endfor %}
      </ul>

      <h3 style="color:var(--omi-neon-pink);">Leave a Review</h3>
      <form action="{% url 'reviews:review_create' product.pk %}" method="post" 
            style="background:rgba(0,0,0,0.7); padding:1rem; border-radius:6px;">
        {% csrf_token %}
        {{ review_form.as_p }}
        <button type="submit" style="background:var(--omi-neon-blue); color:#000; padding:0.5rem 1rem;
                                     border:none; border-radius:4px; box-shadow:0 0 6px var(--omi-neon-blue);">
          Submit
        </button>
      </form>
    </div>
  </div>
{% endblock %}

{% block extra_js %}
  <script src="{% static 'js/product_detail.js' %}" defer></script>
{% endblock %}
